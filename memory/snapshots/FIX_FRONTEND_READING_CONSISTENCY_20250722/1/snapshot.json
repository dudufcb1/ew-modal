{
  "schema_version": "2.0.0",
  "meta": {
    "task_id": "FIX_FRONTEND_READING_CONSISTENCY_20250722",
    "status": "todo",
    "revision": 1,
    "date": "2025-07-22T05:30:00Z",
    "project": "ewm-modal-cta",
    "author": "augment_agent",
    "group_id": "GENERAL",
    "can_agent_set_done": true,
    "rolled_back": false,
    "timestamp": "2025-07-22T05:11:13.774995Z",
    "snapshot_id": "aa64bc82-f1ff-4e6d-a5c9-a2883ad08392",
    "group_md": "groups/GENERAL/group.md"
  },
  "scope": {
    "files": [
      "includes/class-ewm-render-core.php"
    ],
    "components": [
      "Frontend Modal Reading",
      "Modal Configuration"
    ],
    "affected_files": [
      "includes/class-ewm-render-core.php"
    ]
  },
  "problem": {
    "user_request": "Arreglar inconsistencia de lectura: Admin guarda en campos separados (ewm_steps_config, ewm_design_config) pero Frontend lee de ewm_modal_config (vacío). Resultado: modal no muestra steps en frontend."
  },
  "solution": {
    "approach": "Modificar get_modal_configuration() para leer de campos separados donde realmente están los datos, manteniendo consistencia con el sistema de guardado del admin",
    "steps": [
      "Modificar get_modal_configuration() en class-ewm-render-core.php",
      "Cambiar lectura de ewm_modal_config a campos separados",
      "Leer ewm_steps_config, ewm_design_config, ewm_trigger_config, etc.",
      "Unificar datos en memoria para el frontend",
      "Mantener compatibilidad con estructura existente"
    ],
    "implementation_details": {
      "current_problem": "get_post_meta($modal_id, 'ewm_modal_config', true) retorna vacío",
      "new_approach": "Leer de ewm_steps_config, ewm_design_config, ewm_trigger_config, ewm_wc_integration, ewm_display_rules",
      "unification": "Crear array unificado en memoria: array('steps' => json_decode($steps_json), 'design' => json_decode($design_json), ...)",
      "benefits": [
        "Consistencia con admin",
        "Simplicidad",
        "Mantenibilidad",
        "Flexibilidad"
      ]
    }
  },
  "validation": {
    "success_criteria": [
      "Modal 561 muestra steps correctamente en frontend",
      "No más error 'EWMModal no disponible'",
      "Steps se renderizan con datos reales",
      "Logs muestran steps_count > 0"
    ],
    "test_cases": [
      "Cargar http://localhost/plugins/hello-world/",
      "Verificar que modal se muestra",
      "Confirmar que steps aparecen con datos",
      "Revisar logs sin errores"
    ],
    "expected_logs": [
      "EWM RENDER DEBUG - steps_count=1 (no 0)",
      "EWM RENDER DEBUG - steps detail: [datos reales]",
      "Modal se inicializa correctamente"
    ]
  }
}